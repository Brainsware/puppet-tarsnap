#!/bin/sh

title="$1"
shift

keep="$1"
shift

<%- # handle potential absence of GNU coreutils -%>
<%- if @kernel == "Linux" -%>
<%-   cmd_keep  = 'tail -n +${keep}' -%>
<%- else -%>
<%-   cmd_keep  = 'sed "1,${keep}d"' -%>
<%- end -%>
<%= scope.lookupvar("tarsnap::path") %> --list-archives \
  | grep ${title}. \
  | sort -rn \
  | <%= cmd_keep %> \
  | xargs -rn1 <%= scope.lookupvar("tarsnap::path") %> -d -f

